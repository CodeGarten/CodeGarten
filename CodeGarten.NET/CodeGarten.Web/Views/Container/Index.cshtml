@using CodeGarten.Data.Model
@model Container
@{
    ViewBag.Title = string.Format("{0} @ {1}", Model.Name, Model.Prototype.Structure.Name);
}
@Html.Partial("_Container", Model)
<script type="text/javascript">

    window.onpopstate = function () {
        if (!ignore) {
            SwitchContainer(location.href, "left");
        }
        else {
            ignore = false;
        }
    };

    var ignore = true;

    var SwitchContainer = function (location, direction) {
        $.get(location + "?partial=true", function (response) {
            $("#container").fadeOut('fast', function () {
                $("#container").html(response).show("slide", { direction: direction }, 'fast');
                Reload();
            });
        });
    };

    var Reload = function () {
        $(".fader_left").click(function () {
            var url = this.href;
            history.pushState({ path: this.path }, '', this.href);
            SwitchContainer(url, "left");
            return false;
        });

        $(".fader_right").click(function () {
            var url = this.href;
            history.pushState({ path: this.path }, '', this.href);
            SwitchContainer(url, "right");
            return false;
        });
    };

    $("#container").ajaxSend(function () {
        $("#container").mask("Loading...", 200);
    });
    $("#container").ajaxComplete(function () {
        $("#container").unmask();
    });

    Reload();
</script>
