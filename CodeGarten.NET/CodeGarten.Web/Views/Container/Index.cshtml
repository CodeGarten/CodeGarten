@using CodeGarten.Data.Model
@model Container
@{
    ViewBag.Title = string.Format("{0} @ {1}", Model.Name, Model.Prototype.Structure.Name);
}
<script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
@Html.Partial("_Container", Model)
<script type="text/javascript">

    var ignore = true;

    window.onpopstate = function () {
        if (!ignore) {
            SwitchContainer(location.href);
        }
        else
            ignore = false;
    };

    var SwitchContainer = function (_location, callback) {
        var currentContainer = Number($.cookie("currentUrl").substr($.cookie("currentUrl").lastIndexOf("/") + 1));
        var nextContainer = Number(_location.substr(_location.lastIndexOf("/") + 1));

        var direction = nextContainer > currentContainer ? "right" : "left";
        $.get(_location + "?partial=true", function (response) {
            $("#container").fadeOut('fast', function () {
                $("#container").html(response).show("slide", { direction: direction }, 'fast', function () { if (callback) callback(_location) });
            });
        });
    };

    $("#container").ajaxSend(function () {
        $("#container").mask("Loading...", 200);
    });
    $("#container").ajaxComplete(function () {
        $("#container").unmask();
    });
</script>
