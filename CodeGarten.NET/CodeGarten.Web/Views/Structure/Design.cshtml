@model Structure
@using CodeGarten.Data.Model;
@{
    ViewBag.Title = "Design";
}
<link href="@Url.Content("~/Content/themes/styling.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/scripts/ComponentsView.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/scripts/DialogHelper.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/scripts/Workspace.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/scripts/RoleType.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/scripts/Rule.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/scripts/ContainerPrototype.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/scripts/Eventcontroller.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
<h1>
    @Model.Name Design</h1>
<div>
    <div id="components">
    </div>
    <div id="containerPrototypeDesign">
    </div>
    <div id="error">
    </div>
    <div id="actions">
        <button>
            Save</button>
    </div>
</div>
<div id="workspaceCreate">
    @Html.Partial("_WorkspaceCreateForm", new WorkSpaceType())
</div>
<div id="roleTypeCreate">
    @Html.Partial("_RoleTypeCreateForm", new RoleType())
</div>
<div id="ruleCreate">
    @Html.Partial("_RuleCreateForm", new Rule())
</div>
<script type="text/javascript">
    WorkspaceController.Init("#workspaceCreate", @Model.Id);
    RoleTypeView.Init("#roleTypeCreate", @Model.Id);
    RuleView.Init("#ruleCreate", @Model.Id);
    ComponentsView.Init("#components", "Components", ["Workspace", "RoleType", "Rule"]);

    EventController.Init("#error");

    ContainerPrototypeController.Init("#containerPrototypeDesign");
    ContainerPrototypeController.Create();

    $("#actions button").button().click(function () {
        var roles = ContainerPrototypeController.GetRoles("Disciplina");
        
        $.ajax(
        {
            url: "/Structure/Design/" + @Model.Id,
            type: 'POST',
            data: JSON.stringify({roles: roles}),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8'
        }
     );
    });
</script>
